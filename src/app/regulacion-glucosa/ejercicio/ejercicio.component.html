<!-- <div [@textAnimation]> -->
<!-- <span style="font-size: 3rem;" *ngFor="let letter of 'Angular'.split('')">{{ 'letter' }}</span> -->
<!-- <span style="font-size: 3rem">{{ "Comencemos" }}</span> -->
<!-- </div> -->

<!-- <div *ngFor="let opcion of opciones">
  <button
    [@correctaAnimacion]="estados[opcion] === 'correcta' ? 'correcta' : 'normal'"
    [@incorrectaAnimacion]="estados[opcion] === 'incorrecta' ? 'incorrecta' : 'normal'"
    (click)="seleccionar(opcion, $event)">
    {{ opcion }}
  </button>
</div> -->

@if(opcionMenu !== 'introduccion'){
<div [@fadeIn] class="contenedor-ejercicio">
  <div class="indicaciones">
    @if(!ejercicioEnProgreso){
    <h2 class="titulo-explicacion">{{ titulo }}</h2>
    <p>{{ descripcionEjercicio1 }}</p>
    <p>{{ descripcionEjercicio2 }}</p>
    <p>{{ descripcionEjercicio3 }}</p>

    @if(!dialogPreEjercicioVisible && !dialogResultadoVisible){
    <div [@fadeIn] class="flex-row-justify-center">
      <button class="pulse pre-ejercicio-button fucsia-button" (click)="dialogPreEjercicioVisible = true">
        Comenzar Ejercicio
      </button>
    </div>
    } } @else {
    <!-- <h2 @fadeIn class="titulo-explicacion">{{ titulo }}</h2>
    <p style="margin-bottom: 0; margin-top: 7px" @fadeIn>
      {{ descripcionEjercicio1 }}
    </p>
    <p style="margin-top: 5px" @fadeIn>{{ descripcionEjercicio2 }}</p> -->

    <div class="contenedor-vidas">
      <img
        [src]="
          vidasRestantes >= 1
            ? 'images/iconos/life.png'
            : 'images/iconos/lost-life.png'
        "
        alt=""
        class="vida"
      />
      <img
        [src]="
          vidasRestantes >= 2
            ? 'images/iconos/life.png'
            : 'images/iconos/lost-life.png'
        "
        alt=""
        class="vida"
      />
      <img
        [src]="
          vidasRestantes === 3
            ? 'images/iconos/life.png'
            : 'images/iconos/lost-life.png'
        "
        alt=""
        class="vida"
      />
    </div>

    <div @fadeIn class="options-grid">
      <!-- Hígado -->
      <span></span>
      <button
        [class]="
          generalDisableOption || manejoDeOpciones[0].disabled
            ? 'grid-button button-sizing-1 higado-button-disabled'
            : 'grid-button button-sizing-1 higado-button pointer'
        "
        (click)="respuestaSeleccionada('glucogenogenesisHigado', 0)"
        [disabled]="generalDisableOption || manejoDeOpciones[0].disabled"
      >
        Glucogenogénesis
      </button>
      <!-- <div
        [class]="
          generalDisableOption
            ? 'double-arrow-disabled higado-color'
            : 'double-arrow higado-color'
        "
      >
        &#11136;
      </div> -->
      <img src="images/flechas/red-arrows.png" style="height: 50px" alt="" />
      <button
        [class]="
          generalDisableOption || manejoDeOpciones[0].disabled
            ? 'grid-button button-sizing-1 higado-button-disabled'
            : 'grid-button button-sizing-1 higado-button pointer'
        "
        (click)="respuestaSeleccionada('glucogenolisisHigado', 0)"
        [disabled]="generalDisableOption || manejoDeOpciones[0].disabled"
      >
        Glucogenólosis
      </button>
      @if(manejoDeOpciones[0].correct){
      <img
        [@fadeIn]
        src="images/iconos/correct.png"
        style="height: 50px"
        alt="Correcto"
      />
      } @else{
      <span></span>
      }

      <span
        [class]="
          generalDisableOption
            ? 'options-title higado-color-disabled'
            : 'options-title higado-color'
        "
        >Hígado</span
      >
      <button
        [class]="
          generalDisableOption || manejoDeOpciones[1].disabled
            ? 'grid-button button-sizing-1 higado-button-disabled'
            : 'grid-button button-sizing-1 higado-button pointer'
        "
        (click)="respuestaSeleccionada('gluconeogenesis', 1)"
        [disabled]="generalDisableOption || manejoDeOpciones[1].disabled"
      >
        Gluconeogénesis
      </button>
      <!-- <div
        [class]="
          generalDisableOption
            ? 'double-arrow-disabled higado-color'
            : 'double-arrow higado-color'
        "
      >
        &#11136;
      </div> -->
      <img src="images/flechas/red-arrows.png" style="height: 50px" alt="" />
      <button
        [class]="
          generalDisableOption || manejoDeOpciones[1].disabled
            ? 'grid-button button-sizing-1 higado-button-disabled'
            : 'grid-button button-sizing-1 higado-button pointer'
        "
        (click)="respuestaSeleccionada('glucolisis', 1)"
        [disabled]="generalDisableOption || manejoDeOpciones[1].disabled"
      >
        Glucólisis
      </button>
      @if(manejoDeOpciones[1].correct){
      <img
        [@fadeIn]
        src="images/iconos/correct.png"
        style="height: 50px"
        alt="Correcto"
      />
      } @else{
      <span></span>
      }

      <span></span>
      <button
        [class]="
          generalDisableOption || manejoDeOpciones[2].disabled
            ? 'grid-button button-sizing-1 higado-button-disabled'
            : 'grid-button button-sizing-1 higado-button pointer'
        "
        (click)="respuestaSeleccionada('betaOxidacion', 2)"
        [disabled]="generalDisableOption || manejoDeOpciones[2].disabled"
      >
        Beta-oxidación / Cetogénesis
      </button>
      <!-- <div
        [class]="
          generalDisableOption
            ? 'double-arrow-disabled higado-color'
            : 'double-arrow higado-color'
        "
      >
        &#11136;
      </div> -->
      <img src="images/flechas/red-arrows.png" style="height: 50px" alt="" />
      <button
        [class]="
          generalDisableOption || manejoDeOpciones[2].disabled
            ? 'grid-button button-sizing-1 higado-button-disabled'
            : 'grid-button button-sizing-1 higado-button pointer'
        "
        (click)="respuestaSeleccionada('sintesisAcidosGrasos', 2)"
        [disabled]="generalDisableOption || manejoDeOpciones[2].disabled"
      >
        Síntesis de ácidos grasos
      </button>
      @if(manejoDeOpciones[2].correct){
      <img
        [@fadeIn]
        src="images/iconos/correct.png"
        style="height: 50px"
        alt="Correcto"
      />
      } @else{
      <span></span>
      }

      <!-- Músculo -->
      <span
        [class]="
          generalDisableOption
            ? 'options-title musculo-color-disabled margin-top'
            : 'options-title musculo-color margin-top'
        "
        >Músculo</span
      >
      <button
        [class]="
          generalDisableOption || manejoDeOpciones[3].disabled
            ? 'grid-button button-sizing-1 musculo-button-disabled margin-top'
            : 'grid-button button-sizing-1 musculo-button margin-top pointer'
        "
        (click)="respuestaSeleccionada('glucogenogenesisMusculo', 3)"
        [disabled]="generalDisableOption || manejoDeOpciones[3].disabled"
      >
        Glucogénesis
      </button>
      <!-- <div
        [class]="
          generalDisableOption
            ? 'double-arrow-disabled musculo-color margin-top'
            : 'double-arrow musculo-color margin-top'
        "
      >
        &#11136;
      </div> -->
      <img
        src="images/flechas/blue-arrows.png"
        class="margin-top"
        style="height: 50px"
        alt=""
      />
      <button
        [class]="
          generalDisableOption || manejoDeOpciones[3].disabled
            ? 'grid-button button-sizing-1 musculo-button-disabled margin-top'
            : 'grid-button button-sizing-1 musculo-button margin-top pointer'
        "
        (click)="respuestaSeleccionada('glucogenolisisMusculo', 3)"
        [disabled]="generalDisableOption || manejoDeOpciones[3].disabled"
      >
        Glucogenólisis
      </button>
      @if(manejoDeOpciones[3].correct){
      <img
        [@fadeIn]
        src="images/iconos/correct.png"
        style="height: 50px"
        alt="Correcto"
      />
      } @else{
      <span></span>
      } @if(opcionMenu === 'enAyuno'){
      <span></span>
      <button
        [class]="
          generalDisableOption || manejoDeOpciones[4].disabled
            ? 'grid-button button-sizing-1 musculo-button-disabled'
            : 'grid-button button-sizing-1 musculo-button pointer'
        "
        (click)="respuestaSeleccionada('glucogenogenesisMusculo', 4)"
        [disabled]="generalDisableOption || manejoDeOpciones[4].disabled"
      >
        Proteólisis
      </button>
      <!-- <div
          [class]="
            generalDisableOption
              ? 'double-arrow-disabled musculo-color'
              : 'double-arrow musculo-color'
          "
        >
          &#11136;
        </div> -->
      <img src="images/flechas/blue-arrows.png" style="height: 50px" alt="" />
      <button
        [class]="
          generalDisableOption || manejoDeOpciones[4].disabled
            ? 'grid-button button-sizing-1 musculo-button-disabled'
            : 'grid-button button-sizing-1 musculo-button pointer'
        "
        (click)="respuestaSeleccionada('glucogenolisisMusculo', 4)"
        [disabled]="generalDisableOption || manejoDeOpciones[4].disabled"
      >
        Proteogénesis
      </button>
      @if(manejoDeOpciones[4].correct){
      <img
        [@fadeIn]
        src="images/iconos/correct.png"
        style="height: 50px"
        alt="Correcto"
      />
      } @else{
      <span></span>
      } } @else{
      <span></span>
      <button
        [class]="
          generalDisableOption || manejoDeOpciones[4].disabled
            ? 'grid-button button-sizing-1 musculo-button-disabled'
            : 'grid-button button-sizing-1 musculo-button pointer'
        "
        (click)="respuestaSeleccionada('glucogenogenesisMusculo', 4)"
        [disabled]="generalDisableOption || manejoDeOpciones[4].disabled"
      >
        Expresión de Glut4
      </button>
      <!-- <div
          [class]="
            generalDisableOption
              ? 'double-arrow-disabled musculo-color'
              : 'double-arrow musculo-color'
          "
        >
          &#11136;
        </div> -->
      <img src="images/flechas/blue-arrows.png" style="height: 50px" alt="" />
      <button
        [class]="
          generalDisableOption || manejoDeOpciones[4].disabled
            ? 'grid-button button-sizing-1 musculo-button-disabled'
            : 'grid-button button-sizing-1 musculo-button pointer'
        "
        (click)="respuestaSeleccionada('glucogenolisisMusculo', 4)"
        [disabled]="generalDisableOption || manejoDeOpciones[4].disabled"
      >
        Expresión de Glut4
      </button>
      @if(manejoDeOpciones[4].correct){
      <img
        [@fadeIn]
        src="images/iconos/correct.png"
        style="height: 50px"
        alt="Correcto"
      />
      } @else{
      <span></span>
      } }

      <!-- Tejido Adiposo -->
      <span
        [class]="
          generalDisableOption
            ? 'options-title tejido-adiposo-color-disabled margin-top'
            : 'options-title tejido-adiposo-color margin-top'
        "
        >Tejido Adiposo</span
      >
      <button
        [class]="
          generalDisableOption || manejoDeOpciones[5].disabled
            ? 'grid-button button-sizing-1 tejido-adiposo-button-disabled margin-top'
            : 'grid-button button-sizing-1 tejido-adiposo-button margin-top pointer'
        "
        (click)="respuestaSeleccionada('lipolisis', 5)"
        [disabled]="generalDisableOption || manejoDeOpciones[5].disabled"
      >
        Lipólisis
      </button>
      <!-- <div
        [class]="
          generalDisableOption
            ? 'double-arrow-disabled tejido-adiposo-color margin-top'
            : 'double-arrow tejido-adiposo-color margin-top'
        "
      >
        &#11136;
      </div> -->
      <img
        src="images/flechas/green-arrows.png"
        class="margin-top"
        style="height: 50px"
        alt=""
      />
      <button
        [class]="
          generalDisableOption || manejoDeOpciones[5].disabled
            ? 'grid-button button-sizing-1 tejido-adiposo-button-disabled margin-top'
            : 'grid-button button-sizing-1 tejido-adiposo-button margin-top pointer'
        "
        (click)="respuestaSeleccionada('lipogenesis', 5)"
        [disabled]="generalDisableOption || manejoDeOpciones[5].disabled"
      >
        Lipogénesis
      </button>
      @if(manejoDeOpciones[5].correct){
      <img
        [@fadeIn]
        src="images/iconos/correct.png"
        style="height: 50px"
        alt="Correcto"
      />
      } @else{
      <span></span>
      } @if(opcionMenu === 'luegoDeAlimentarse'){
      <span></span>
      <button
        [class]="
          generalDisableOption || manejoDeOpciones[6].disabled
            ? 'grid-button button-sizing-1 tejido-adiposo-button-disabled'
            : 'grid-button button-sizing-1 tejido-adiposo-button pointer'
        "
        (click)="respuestaSeleccionada('lipolisis', 6)"
        [disabled]="generalDisableOption || manejoDeOpciones[6].disabled"
      >
        Expresión de Glut4
      </button>
      <!-- <div
          [class]="
            generalDisableOption
              ? 'double-arrow-disabled tejido-adiposo-color'
              : 'double-arrow tejido-adiposo-color'
          "
        >
          &#11136;
        </div> -->
      <img src="images/flechas/green-arrows.png" style="height: 50px" alt="" />
      <button
        [class]="
          generalDisableOption || manejoDeOpciones[6].disabled
            ? 'grid-button button-sizing-1 tejido-adiposo-button-disabled'
            : 'grid-button button-sizing-1 tejido-adiposo-button pointer'
        "
        (click)="respuestaSeleccionada('lipogenesis', 6)"
        [disabled]="generalDisableOption || manejoDeOpciones[6].disabled"
      >
        Expresión de Glut4
      </button>
      @if(manejoDeOpciones[6].correct){
      <img
        [@fadeIn]
        src="images/iconos/correct.png"
        style="height: 50px"
        alt="Correcto"
      />
      } @else{
      <span></span>
      } }
    </div>
    }
  </div>

  <div class="animacion">
    <!-- PONER ABAJO DE LAS OPCIONES -->
    <!-- PONER ABAJO DE LAS OPCIONES -->
    <!-- PONER ABAJO DE LAS OPCIONES -->
    <!-- PONER ABAJO DE LAS OPCIONES -->

    <div #contenedorBarraImagen class="contenedor-barra-imagen">
      <div #barraLateralMedicion class="barra-lateral-medicion">
        @for (medida of escalaMedidas; track medida) {
        <div class="flecha-medicion">
          <img
            *ngIf="medidaActual == medida"
            class="flecha-nivel flecha-pulsante"
            [@fadeIn]
            src="images/flechas/1.png"
          />
          @if([10, 5, 0].includes(medida)){
          <span>{{ medida + "mg/dl" }}</span>
          } @else {
          <span *ngIf="medidaActual == medida" [@fadeIn]>{{
            medida + "mg/dl"
          }}</span>
          }
        </div>
        }
      </div>

      <div class="shadow">
        <div>
          <div class="barra-lateral-top">
            <span>H</span>
            <span>I</span>
            <span>P</span>
            <span>E</span>
            <span>R</span>
          </div>

          <div class="centro-barras-laterales"></div>

          <div class="barra-lateral-bottom">
            <span>H</span>
            <span>I</span>
            <span>P</span>
            <span>O</span>
          </div>
        </div>

        <div class="contenedor-imagen">
          <img
            #imagen2
            class="imagen"
            [@imageFade]="imageFade2"
            src="images/estados/estado-2.png"
          />
          <img
            #imagen1
            class="imagen-2"
            [@imageFade]="imageFade1"
            src="images/estados/estado-1.png"
          />
          <img
            #imagen3
            class="imagen-2"
            [@imageFade]="imageFade3"
            src="images/estados/estado-3.png"
          />
          <img
            #imagen4
            class="imagen-2"
            [@imageFade]="imageFade4"
            src="images/estados/estado-4.png"
          />
        </div>
      </div>
    </div>

    <div class="concentracion">
      <span>Concentración de Glucosa: </span
      ><span>{{ medidaActual }}mg/dl</span>
    </div>

    <div class="estado">
      @if(!ejercicioEnProgreso){
      <div class="titulo-estado">
        Estado: <span class="buen-estado">{{ estado }}</span>
      </div>
      } @else {
      <div @fadeIn class="titulo-estado">
        Estado: <span class="mal-estado">{{ estado }}</span>
      </div>
      <!-- paso a mostrar el mensaje alerta con las letras del mensaje normal en respuesta a la elección de una opcion -->
      <!-- <div @fadeIn class="mensaje-alerta">
        {{ mensajeAlerta }}
      </div> -->
      <div @fadeIn class="mensaje-estado">
        {{ mensajeAlerta }}
      </div>
      }
    </div>
  </div>
</div>
}

<!-- Popup de resultados -->

<!-- Capaz que tienen que tener una altura fija siempre los popups -->
<!-- ESTOS IF NO TIENEN QUE SER NECESARIOS -->
<!-- ESTOS IF NO TIENEN QUE SER NECESARIOS -->
<!-- ESTOS IF NO TIENEN QUE SER NECESARIOS -->

<!-- Los if no molestan, pero el minWidth y minHeight no estan funcionando -->
<!-- Los if no molestan, pero el minWidth y minHeight no estan funcionando -->
<!-- Los if no molestan, pero el minWidth y minHeight no estan funcionando -->
<!-- Los if no molestan, pero el minWidth y minHeight no estan funcionando -->
@if(dialogResultadoVisible){
<p-dialog
  [visible]="dialogResultadoVisible"
  [@popupFade]="dialogResultadoFade"
  [modal]="true"
  [ngClass]="dialogResultadoCorrecto ? 'dialog-correcto' : 'dialog-error'"
  [style]="{
    minWidth: '360x',
    minHeight: '460px',
    maxWidth: '450px',
    maxHeight: '525px',
    width: '30vw',
    height: '60vh'
  }"
>
  <ng-template pTemplate="headless">
    <div class="dialog-resultado">
      <div class="dialog-text-container">
        <img
          style="width: 170px"
          [src]="
            dialogResultadoCorrecto
              ? 'images/iconos/happy.png'
              : 'images/iconos/dead.png'
          "
        />
        <span class="dialog-title">
          {{ dialogResultadoCorrecto ? "Muy bien!" : "Que mal!" }}</span
        >
        <div
          style="
            text-align: center;
            font-size: 1.3rem;
            padding: 7px 0;
            font-weight: 700;
            border-bottom: 3px solid #000241;
            border-top: 3px solid #000241;
          "
        >
          {{ mensajeDialogResultado }}
        </div>
      </div>

      @if(showButtonsDialogResultado){
      <div>
        @if(!dialogResultadoCorrecto){
          <button
            style="margin-right: 15px"
            class="pre-ejercicio-button red-button"
            (click)="ejercicioEnProgreso ? restart() : ''; dialogResultadoVisible = false"
          >
            Reintentarlo
          </button>
          } @if(dialogResultadoCorrecto){
          <button
            style="margin-right: 15px"
            class="pre-ejercicio-button fucsia-button"
            (click)="irAlSiguienteEscenario()"
          >
            Ir al siguiente escenario
          </button>
          }
          <button
            [class]="
              dialogResultadoCorrecto
                ? 'pre-ejercicio-button fucsia-button'
                : 'pre-ejercicio-button red-button'
            "
            (click)="irAlInicio()"
          >
            Ir al Inicio
          </button>
      </div>
      } @else{
      <span class="dialog-title">Continuemos!</span>
      }
    </div>
  </ng-template>
</p-dialog>
}

<!-- Insulina (única correcta en after eating), Glucagón, Adrenalina, Hormona del Crecimiento (GH) y Cortisol (estas últimas cuatro son correctas en fasting). -->
<!-- Popup de preguntas pre-ejercicio -->
@if(dialogPreEjercicioVisible){
<p-dialog
  [visible]="dialogPreEjercicioVisible"
  [modal]="true"
  ngClass="dialog-hormonas"
  [style]="{
    minWidth: '290px',
    minHeight: '500px',
    maxWidth: '450px',
    maxHeight: '550px',
    width: '30vw',
    height: '75vh'
  }"
>
  <ng-template pTemplate="headless">
    <div class="dialog-hormonas">
      <div
        style="
          display: flex;
          align-items: center;
          justify-content: space-between;
          width: 100%;
          padding: 0;
          margin: 0;
        "
      >
        <img
          class="pulse"
          style="height: 70px; margin-bottom: 10px"
          src="images/iconos/thinking.png"
          alt="León con signo de pregunta"
        />

        <div
          class="pre-ejercicio-text"
          style="font-size: 1.7rem; font-weight: 800; margin-bottom: 10px"
        >
          Para comenzar!
        </div>

        <img
          class="pulse"
          style="height: 70px; margin-bottom: 10px"
          src="images/iconos/thinking.png"
          alt="León con signo de pregunta"
        />
      </div>

      <div>
        <div
          class="pre-ejercicio-text"
          style="
            font-size: 1.1rem;
            padding: 5px 0;
            font-weight: 700;
            border-bottom: 3px solid #39023c;
            border-top: 3px solid #39023c;
          "
        >
          Elige una hormona del listado que vaya a colaborar en el ejercicio
          seleccionado
        </div>
      </div>

      <button
        class="pre-ejercicio-button red-button"
        (click)="hormonaSeleccionada('insulina')"
      >
        Insulina
      </button>
      <button
        class="pre-ejercicio-button blue-button"
        (click)="hormonaSeleccionada('noInsulina')"
      >
        Glucagón
      </button>

      <button
        class="pre-ejercicio-button green-button"
        (click)="hormonaSeleccionada('noInsulina')"
      >
        Adrenalina</button
      ><button
        class="pre-ejercicio-button yellow-button"
        (click)="hormonaSeleccionada('noInsulina')"
      >
        Hormona del Crecimiento (GH)</button
      ><button
        class="pre-ejercicio-button purple-button"
        (click)="hormonaSeleccionada('noInsulina')"
      >
        Cortisol
      </button>
    </div>
  </ng-template>
</p-dialog>
}

<!-- Popup de navegación al intentar salir -->
@if(dialogSalirVisible){
<p-dialog
  [visible]="dialogSalirVisible"
  [modal]="true"
  ngClass="dialog-salir"
  [style]="{
    minWidth: '370px',
    minHeight: '150px',
    width: '30vw',
    height: '33vh'
  }"
>
  <ng-template pTemplate="headless">
    <div class="dialog-salir">
      <div class="dialog-text-container">
        <span class="dialog-title-2"> Seguro que deseas salir?</span>
        <span class="dialog-text">
          Si sales ahora el progreso del ejercicio se perderá
        </span>
      </div>

      <div>
        <button
          style="margin-right: 10px"
          class="dialog-button dialog-button-salir"
          (click)="resetearEjercicio(); dialogSalirVisible = false"
        >
          Salir
        </button>
        <button
          class="dialog-button dialog-button-salir"
          (click)="opcionMenuTentativa = ''; dialogSalirVisible = false"
        >
          Volver
        </button>
      </div>
    </div>
  </ng-template>
</p-dialog>
}
